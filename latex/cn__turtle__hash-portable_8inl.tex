\hypertarget{cn__turtle__hash-portable_8inl}{}\doxysection{src/crypto/cn\+\_\+turtle\+\_\+hash-\/portable.inl File Reference}
\label{cn__turtle__hash-portable_8inl}\index{src/crypto/cn\_turtle\_hash-\/portable.inl@{src/crypto/cn\_turtle\_hash-\/portable.inl}}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=190pt]{cn__turtle__hash-portable_8inl__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
union \mbox{\hyperlink{unioncn__turtle__hash__state}{cn\+\_\+turtle\+\_\+hash\+\_\+state}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a07eb808f20dd529e9acb42d417fbfaad}{U64}}(x)~((uint64\+\_\+t $\ast$) (x))
\item 
\#define \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a89118be7b71e0f3e547f3778e4d668f7}{state\+\_\+index}}(x,  div)~((($\ast$((uint64\+\_\+t $\ast$)x) $>$$>$ 4) \& (T\+O\+T\+A\+L\+B\+L\+O\+C\+KS /(div) -\/ 1)) $<$$<$ 4)
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{cn__turtle__hash-portable_8inl_ae42f517f28e2f287a572e1f8a6d19f4c}{aesb\+\_\+single\+\_\+round}} (const uint8\+\_\+t $\ast$in, uint8\+\_\+t $\ast$out, const uint8\+\_\+t $\ast$expanded\+Key)
\item 
int \mbox{\hyperlink{cn__turtle__hash-portable_8inl_af59cb7c07f75d116013afd583cc1d6e9}{aesb\+\_\+pseudo\+\_\+round}} (const uint8\+\_\+t $\ast$in, uint8\+\_\+t $\ast$out, const uint8\+\_\+t $\ast$expanded\+Key)
\item 
static void \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a142b63d442a25163b2b6fe8e02af59a6}{mul}} (const uint8\+\_\+t $\ast$a, const uint8\+\_\+t $\ast$b, uint8\+\_\+t $\ast$res)
\item 
static void \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a7995c66f925960abcd510324d7644173}{sum\+\_\+half\+\_\+blocks}} (uint8\+\_\+t $\ast$a, const uint8\+\_\+t $\ast$b)
\item 
static void \mbox{\hyperlink{cn__turtle__hash-portable_8inl_afe30298f4973d919d14cae59b45582e1}{copy\+\_\+block}} (uint8\+\_\+t $\ast$dst, const uint8\+\_\+t $\ast$src)
\item 
static void \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a3e8a21fd53a0938c299c2b76919ea5fe}{swap\+\_\+blocks}} (uint8\+\_\+t $\ast$a, uint8\+\_\+t $\ast$b)
\item 
static void \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a9f6e6adeba568ba782a72a2fb02c403e}{xor\+\_\+blocks}} (uint8\+\_\+t $\ast$a, const uint8\+\_\+t $\ast$b)
\item 
static void \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a4aadf2a19b403512e1625a0c40a8e0db}{xor64}} (uint8\+\_\+t $\ast$left, const uint8\+\_\+t $\ast$right)
\item 
void \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a3cb9143c03520ab27af6d37f1193d065}{cn\+\_\+turtle\+\_\+hash}} (const void $\ast$data, size\+\_\+t length, unsigned char $\ast$hash, int light, int variant, int prehashed, uint32\+\_\+t scratchpad, uint32\+\_\+t iterations)
\begin{DoxyCompactList}\small\item\em the hash function implementing Crypto\+Night, used for the Monero proof-\/of-\/work \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static void($\ast$const \mbox{\hyperlink{cn__turtle__hash-portable_8inl_a0d917f0dffcab5c03bc5450669823461}{extra\+\_\+hashes}} \mbox{[}4\mbox{]})(const void $\ast$, size\+\_\+t, unsigned char $\ast$)
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a89118be7b71e0f3e547f3778e4d668f7}\label{cn__turtle__hash-portable_8inl_a89118be7b71e0f3e547f3778e4d668f7}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!state\_index@{state\_index}}
\index{state\_index@{state\_index}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{state\_index}{state\_index}}
{\footnotesize\ttfamily \#define state\+\_\+index(\begin{DoxyParamCaption}\item[{}]{x,  }\item[{}]{div }\end{DoxyParamCaption})~((($\ast$((uint64\+\_\+t $\ast$)x) $>$$>$ 4) \& (T\+O\+T\+A\+L\+B\+L\+O\+C\+KS /(div) -\/ 1)) $<$$<$ 4)}

\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a07eb808f20dd529e9acb42d417fbfaad}\label{cn__turtle__hash-portable_8inl_a07eb808f20dd529e9acb42d417fbfaad}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!U64@{U64}}
\index{U64@{U64}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{U64}{U64}}
{\footnotesize\ttfamily \#define U64(\begin{DoxyParamCaption}\item[{}]{x }\end{DoxyParamCaption})~((uint64\+\_\+t $\ast$) (x))}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_af59cb7c07f75d116013afd583cc1d6e9}\label{cn__turtle__hash-portable_8inl_af59cb7c07f75d116013afd583cc1d6e9}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!aesb\_pseudo\_round@{aesb\_pseudo\_round}}
\index{aesb\_pseudo\_round@{aesb\_pseudo\_round}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{aesb\_pseudo\_round()}{aesb\_pseudo\_round()}}
{\footnotesize\ttfamily int aesb\+\_\+pseudo\+\_\+round (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t $\ast$}]{in,  }\item[{uint8\+\_\+t $\ast$}]{out,  }\item[{const uint8\+\_\+t $\ast$}]{expanded\+Key }\end{DoxyParamCaption})}

\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_ae42f517f28e2f287a572e1f8a6d19f4c}\label{cn__turtle__hash-portable_8inl_ae42f517f28e2f287a572e1f8a6d19f4c}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!aesb\_single\_round@{aesb\_single\_round}}
\index{aesb\_single\_round@{aesb\_single\_round}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{aesb\_single\_round()}{aesb\_single\_round()}}
{\footnotesize\ttfamily int aesb\+\_\+single\+\_\+round (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t $\ast$}]{in,  }\item[{uint8\+\_\+t $\ast$}]{out,  }\item[{const uint8\+\_\+t $\ast$}]{expanded\+Key }\end{DoxyParamCaption})}

\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a3cb9143c03520ab27af6d37f1193d065}\label{cn__turtle__hash-portable_8inl_a3cb9143c03520ab27af6d37f1193d065}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!cn\_turtle\_hash@{cn\_turtle\_hash}}
\index{cn\_turtle\_hash@{cn\_turtle\_hash}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{cn\_turtle\_hash()}{cn\_turtle\_hash()}}
{\footnotesize\ttfamily void cn\+\_\+turtle\+\_\+hash (\begin{DoxyParamCaption}\item[{const void $\ast$}]{data,  }\item[{size\+\_\+t}]{length,  }\item[{unsigned char $\ast$}]{hash,  }\item[{int}]{light,  }\item[{int}]{variant,  }\item[{int}]{prehashed,  }\item[{uint32\+\_\+t}]{scratchpad,  }\item[{uint32\+\_\+t}]{iterations }\end{DoxyParamCaption})}



the hash function implementing Crypto\+Night, used for the Monero proof-\/of-\/work 

Computes the hash of $<$data$>$ (which consists of $<$length$>$ bytes), returning the hash in $<$hash$>$. The Crypto\+Night hash operates by first using Keccak 1600, the 1600 bit variant of the Keccak hash used in S\+H\+A-\/3, to create a 200 byte buffer of pseudorandom data by hashing the supplied data. It then uses this random data to fill a large 2MB buffer with pseudorandom data by iteratively encrypting it using 10 rounds of A\+ES per entry. After this initialization, it executes 524,288 rounds of mixing through the random 2MB buffer using A\+ES (typically provided in hardware on modern C\+P\+Us) and a 64 bit multiply. Finally, it re-\/mixes this large buffer back into the 200 byte \char`\"{}text\char`\"{} buffer, and then hashes this buffer using one of four pseudorandomly selected hash functions (Blake, Groestl, JH, or Skein) to populate the output.

The 2MB buffer and choice of functions for mixing are designed to make the algorithm \char`\"{}\+C\+P\+U-\/friendly\char`\"{} (and thus, reduce the advantage of G\+PU, F\+P\+GA, or A\+S\+I\+C-\/based implementations)\+: the functions used are fast on modern C\+P\+Us, and the 2MB size matches the typical amount of L3 cache available per core on 2013-\/era C\+P\+Us. When available, this implementation will use hardware A\+ES support on x86 C\+P\+Us.

A diagram of the inner loop of this function can be found at \href{https://www.cs.cmu.edu/~dga/crypto/xmr/cryptonight.png}{\texttt{ https\+://www.\+cs.\+cmu.\+edu/$\sim$dga/crypto/xmr/cryptonight.\+png}}


\begin{DoxyParams}{Parameters}
{\em data} & the data to hash \\
\hline
{\em length} & the length in bytes of the data \\
\hline
{\em hash} & a pointer to a buffer in which the final 256 bit hash will be stored \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_afe30298f4973d919d14cae59b45582e1}\label{cn__turtle__hash-portable_8inl_afe30298f4973d919d14cae59b45582e1}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!copy\_block@{copy\_block}}
\index{copy\_block@{copy\_block}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{copy\_block()}{copy\_block()}}
{\footnotesize\ttfamily static void copy\+\_\+block (\begin{DoxyParamCaption}\item[{uint8\+\_\+t $\ast$}]{dst,  }\item[{const uint8\+\_\+t $\ast$}]{src }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a142b63d442a25163b2b6fe8e02af59a6}\label{cn__turtle__hash-portable_8inl_a142b63d442a25163b2b6fe8e02af59a6}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!mul@{mul}}
\index{mul@{mul}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{mul()}{mul()}}
{\footnotesize\ttfamily static void mul (\begin{DoxyParamCaption}\item[{const uint8\+\_\+t $\ast$}]{a,  }\item[{const uint8\+\_\+t $\ast$}]{b,  }\item[{uint8\+\_\+t $\ast$}]{res }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a7995c66f925960abcd510324d7644173}\label{cn__turtle__hash-portable_8inl_a7995c66f925960abcd510324d7644173}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!sum\_half\_blocks@{sum\_half\_blocks}}
\index{sum\_half\_blocks@{sum\_half\_blocks}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{sum\_half\_blocks()}{sum\_half\_blocks()}}
{\footnotesize\ttfamily static void sum\+\_\+half\+\_\+blocks (\begin{DoxyParamCaption}\item[{uint8\+\_\+t $\ast$}]{a,  }\item[{const uint8\+\_\+t $\ast$}]{b }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a3e8a21fd53a0938c299c2b76919ea5fe}\label{cn__turtle__hash-portable_8inl_a3e8a21fd53a0938c299c2b76919ea5fe}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!swap\_blocks@{swap\_blocks}}
\index{swap\_blocks@{swap\_blocks}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{swap\_blocks()}{swap\_blocks()}}
{\footnotesize\ttfamily static void swap\+\_\+blocks (\begin{DoxyParamCaption}\item[{uint8\+\_\+t $\ast$}]{a,  }\item[{uint8\+\_\+t $\ast$}]{b }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a4aadf2a19b403512e1625a0c40a8e0db}\label{cn__turtle__hash-portable_8inl_a4aadf2a19b403512e1625a0c40a8e0db}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!xor64@{xor64}}
\index{xor64@{xor64}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{xor64()}{xor64()}}
{\footnotesize\ttfamily static void xor64 (\begin{DoxyParamCaption}\item[{uint8\+\_\+t $\ast$}]{left,  }\item[{const uint8\+\_\+t $\ast$}]{right }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a9f6e6adeba568ba782a72a2fb02c403e}\label{cn__turtle__hash-portable_8inl_a9f6e6adeba568ba782a72a2fb02c403e}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!xor\_blocks@{xor\_blocks}}
\index{xor\_blocks@{xor\_blocks}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{xor\_blocks()}{xor\_blocks()}}
{\footnotesize\ttfamily static void xor\+\_\+blocks (\begin{DoxyParamCaption}\item[{uint8\+\_\+t $\ast$}]{a,  }\item[{const uint8\+\_\+t $\ast$}]{b }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{cn__turtle__hash-portable_8inl_a0d917f0dffcab5c03bc5450669823461}\label{cn__turtle__hash-portable_8inl_a0d917f0dffcab5c03bc5450669823461}} 
\index{cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}!extra\_hashes@{extra\_hashes}}
\index{extra\_hashes@{extra\_hashes}!cn\_turtle\_hash-\/portable.inl@{cn\_turtle\_hash-\/portable.inl}}
\doxysubsubsection{\texorpdfstring{extra\_hashes}{extra\_hashes}}
{\footnotesize\ttfamily void($\ast$const extra\+\_\+hashes\mbox{[}4\mbox{]})(const void $\ast$, size\+\_\+t, unsigned char $\ast$)\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{= \{}
\DoxyCodeLine{  \mbox{\hyperlink{hash-extra-blake_8c_a55c4579196fc715f407ee2c75a9899e5}{hash\_extra\_blake}}, \mbox{\hyperlink{hash-extra-groestl_8c_aa1b761a61f8c2f5d9f586511cae6bcd9}{hash\_extra\_groestl}}, \mbox{\hyperlink{hash-extra-jh_8c_ac767f7f2c73702e51e3be44c02b74552}{hash\_extra\_jh}}, \mbox{\hyperlink{hash-extra-skein_8c_a5bb2d6e926702f764f9ae51462998448}{hash\_extra\_skein}}}
\DoxyCodeLine{\}}

\end{DoxyCode}
